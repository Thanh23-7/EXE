<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Th√¥ng Tin T√†i Kho·∫£n - Green Fresh</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        /* C√°c style gi·ªØ nguy√™n t·ª´ b·∫£n g·ªëc */
        .bg-gradient-green { background: linear-gradient(135deg, #10b981 0%, #059669 100%); }
        .btn-primary { 
            background: linear-gradient(135deg, #10b981 0%, #059669 100%); 
            color: #fff;
            box-shadow: 0 2px 8px rgba(16,185,129,0.15);
            transition: all 0.3s;
        }
        .btn-primary:hover {
            transform: translateY(-1px);
            box-shadow: 0 8px 20px rgba(16,185,129,0.2);
        }
        /* FIX cho dropdown profile */
        .group:hover .group-hover\:opacity-100 {
            opacity: 1 !important;
            visibility: visible !important;
            transform: scale(1) !important;
        }
    </style>
</head>
<body class="bg-gray-100 min-h-screen">
    <header class="bg-white shadow-md sticky top-0 z-50">
        <div class="container mx-auto px-4">
            <div class="flex items-center justify-between py-4">
                <a href="index.html" class="flex items-center space-x-2">
                    <div class="w-10 h-10 bg-gradient-green rounded-full flex items-center justify-center shadow-lg">
                        <i class="fas fa-leaf text-white text-xl"></i>
                    </div>
                    <span class="text-2xl font-extrabold text-green-600 tracking-wide">Green Fresh</span>
                </a>
                <nav class="hidden md:flex space-x-8">
                    <a href="index.html" class="text-gray-700 hover:text-green-600 font-semibold transition">Trang ch·ªß</a>
                    <a href="product.html" class="text-gray-700 hover:text-green-600 font-semibold transition">S·∫£n ph·∫©m</a>
                    <a href="product-detail.html" class="text-gray-700 hover:text-green-600 font-semibold transition">V·ªÅ ch√∫ng t√¥i</a>
                    <a href="forgotpassword.html" class="text-gray-700 hover:text-green-600 font-semibold transition">Li√™n h·ªá</a>
                </nav>
                <div class="flex items-center space-x-4">
                    <div class="relative hidden md:block">
                        <input type="text" placeholder="T√¨m ki·∫øm s·∫£n ph·∫©m..." 
                                class="w-64 px-4 py-2 border border-gray-300 rounded-full focus:outline-none focus:ring-2 focus:ring-green-500 shadow-sm">
                        <i class="fas fa-search absolute right-3 top-3 text-gray-400"></i>
                    </div>
                    <a href="cart.html">
                        <button class="relative p-2 text-gray-700 hover:text-green-600">
                            <i class="fas fa-shopping-cart text-xl"></i>
                            <span id="cart-count" class="absolute -top-1 -right-1 bg-red-500 text-white text-xs rounded-full w-5 h-5 flex items-center justify-center">0</span>
                        </button>
                    </a>
                    <div id="user-info" class="flex items-center space-x-2"></div>
                </div>
                <button class="md:hidden p-2 rounded-full hover:bg-green-100">
                    <i class="fas fa-bars text-xl"></i>
                </button>
            </div>
        </div>
    </header>

    <main class="container mx-auto px-4 py-12">
        <nav class="text-sm mb-6">
            <a href="index.html" class="text-gray-500 hover:text-green-600">Trang ch·ªß</a>
            <span class="mx-2">/</span>
            <span class="text-green-600 font-semibold">Th√¥ng tin c√° nh√¢n</span>
        </nav>

        <div class="max-w-4xl mx-auto bg-white p-8 rounded-xl shadow-lg">
            <h1 class="text-3xl font-bold text-green-700 mb-8 flex items-center">
                <i class="fas fa-user-circle mr-3"></i> H·ªì s∆° c·ªßa t√¥i
            </h1>
            
            <div id="alert-message" class="mb-4 hidden p-3 rounded-lg text-sm" role="alert"></div>

            <div class="grid md:grid-cols-3 gap-8">
                <div class="col-span-1 border-r border-gray-200 pr-8">
                    
                    <section class="mb-8 text-center">
                        <h2 class="text-xl font-semibold text-gray-700 mb-4 flex items-center justify-center gap-2">
                             ·∫¢nh ƒë·∫°i di·ªán
                        </h2>
                        <img id="profile-avatar" src="https://via.placeholder.com/120/10B981/FFFFFF?text=U" alt="Avatar" 
                             class="w-32 h-32 rounded-full object-cover border-4 border-green-400 shadow-lg mx-auto mb-4">
                        
                        <label for="avatar-input" class="cursor-pointer bg-green-500 text-white px-4 py-2 rounded-full hover:bg-green-600 transition text-sm">
                            <i class="fas fa-camera mr-2"></i> Ch·ªçn ·∫¢nh
                        </label>
                        <input type="file" id="avatar-input" accept="image/*" class="hidden">
                        
                        <button id="update-avatar-btn" class="bg-blue-500 text-white px-4 py-2 rounded-full hover:bg-blue-600 transition text-sm mt-3 hidden">
                            <i class="fas fa-upload mr-2"></i> L∆∞u Avatar
                        </button>
                        <p id="avatar-status" class="text-xs mt-2 text-gray-500"></p>
                    </section>
                    
                    <hr class="my-6">

                    <section>
                        <h2 class="text-xl font-semibold text-gray-700 mb-4 flex items-center gap-2">
                            <i class="fas fa-lock text-red-500"></i> ƒê·ªïi m·∫≠t kh·∫©u
                        </h2>
                        <form id="password-form">
                            <div class="mb-3">
                                <input type="password" id="current-password" placeholder="M·∫≠t kh·∫©u hi·ªán t·∫°i" required
                                       class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-red-500">
                            </div>
                            <div class="mb-4">
                                <input type="password" id="new-password" placeholder="M·∫≠t kh·∫©u m·ªõi (√≠t nh·∫•t 6 k√Ω t·ª±)" required
                                       class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-red-500">
                            </div>
                            <button type="submit" class="w-full bg-red-500 text-white px-4 py-2 rounded-lg font-semibold hover:bg-red-600 transition">
                                ƒê·ªïi m·∫≠t kh·∫©u
                            </button>
                            <p id="password-status" class="text-xs text-center mt-2 text-red-500"></p>
                        </form>
                    </section>
                </div>

                <div class="md:col-span-2">
                    <h2 class="text-2xl font-bold text-gray-700 mb-6 border-b pb-2">Th√¥ng tin c∆° b·∫£n & Giao h√†ng</h2>
                    <form id="profile-form">
                        <div class="grid grid-cols-1 sm:grid-cols-2 gap-5">
                            <div>
                                <h3 class="font-semibold text-lg mb-3 text-green-600"><i class="fas fa-user mr-2"></i> Th√¥ng tin c√° nh√¢n</h3>
                                <div class="mb-4">
                                    <label for="email" class="block text-gray-700 font-medium mb-1">Email</label>
                                    <input type="email" id="email" name="email" readonly
                                        class="w-full px-4 py-2 border border-gray-300 bg-gray-50 rounded-lg cursor-not-allowed">
                                </div>
                                <div class="mb-4">
                                    <label for="displayName" class="block text-gray-700 font-medium mb-1">T√™n hi·ªÉn th·ªã</label>
                                    <input type="text" id="displayName" name="displayName"
                                        class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500"
                                        placeholder="T√™n c·ªßa b·∫°n">
                                </div>
                                <div class="mb-4">
                                    <label for="gender" class="block text-gray-700 font-medium mb-1">Gi·ªõi t√≠nh</label>
                                    <select id="gender" name="gender" 
                                        class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500">
                                        <option value="" disabled selected>Ch·ªçn gi·ªõi t√≠nh</option>
                                        <option value="male">Nam</option>
                                        <option value="female">N·ªØ</option>
                                        <option value="other">Kh√°c</option>
                                    </select>
                                </div>
                            </div>
                            
                            <div>
                                <h3 class="font-semibold text-lg mb-3 text-green-600"><i class="fas fa-truck-fast mr-2"></i> Th√¥ng tin giao h√†ng</h3>
                                <div class="mb-4">
                                    <label for="phone" class="block text-gray-700 font-medium mb-1">S·ªë ƒëi·ªán tho·∫°i</label>
                                    <input type="tel" id="phone" name="phone"
                                        class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500"
                                        placeholder="S·ªë ƒëi·ªán tho·∫°i c·ªßa b·∫°n">
                                </div>
                                <div class="mb-4">
                                    <label for="address" class="block text-gray-700 font-medium mb-1">ƒê·ªãa ch·ªâ giao h√†ng</label>
                                    <textarea id="address" name="address" rows="5"
                                        class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500"
                                        placeholder="S·ªë nh√†, t√™n ƒë∆∞·ªùng, Ph∆∞·ªùng/X√£, Qu·∫≠n/Huy·ªán, T·ªânh/Th√†nh ph·ªë"></textarea>
                                </div>
                            </div>
                        </div>

                        <div class="flex justify-start mt-8 border-t pt-6">
                            <button type="submit" class="btn-primary px-8 py-3 rounded-full font-semibold">
                                <i class="fas fa-save mr-2"></i> L∆∞u thay ƒë·ªïi
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </main>

    <footer class="bg-gray-800 text-white py-12 mt-12">
        <div class="container mx-auto px-4">
            <div class="grid md:grid-cols-4 gap-8">
                <div>
                    <div class="flex items-center space-x-2 mb-4">
                        <div class="w-8 h-8 bg-green-500 rounded-full flex items-center justify-center">
                            <i class="fas fa-leaf text-white"></i>
                        </div>
                        <span class="text-xl font-bold">Green Fresh</span>
                    </div>
                    <p class="text-gray-400 mb-4">
                        Cung c·∫•p th·ª±c ph·∫©m xanh s·∫°ch, an to√†n cho s·ª©c kh·ªèe gia ƒë√¨nh Vi·ªát.
                    </p>
                    <div class="flex space-x-4">
                        <a href="https://facebook.com" class="text-gray-400 hover:text-white"><i class="fab fa-facebook"></i></a>
                        <a href="https://instagram.com" class="text-gray-400 hover:text-white"><i class="fab fa-instagram"></i></a>
                        <a href="https://youtube.com" class="text-gray-400 hover:text-white"><i class="fab fa-youtube"></i></a>
                    </div>
                </div>
                
                <div>
                    <h3 class="text-lg font-semibold mb-4">S·∫£n ph·∫©m</h3>
                    <ul class="space-y-2 text-gray-400">
                        <li><a href="product.html" class="hover:text-white">Rau c·ªß qu·∫£</a></li>
                        <li><a href="product.html" class="hover:text-white">Tr√°i c√¢y</a></li>
                        <li><a href="product.html" class="hover:text-white">Th·ªãt s·∫°ch</a></li>
                        <li><a href="product.html" class="hover:text-white">H·∫£i s·∫£n</a></li>
                    </ul>
                </div>
                
                <div>
                    <h3 class="text-lg font-semibold mb-4">H·ªó tr·ª£</h3>
                    <ul class="space-y-2 text-gray-400">
                        <li><a href="forgotpassword.html" class="hover:text-white">Li√™n h·ªá</a></li>
                        <li><a href="index.html" class="hover:text-white">Ch√≠nh s√°ch ƒë·ªïi tr·∫£</a></li>
                        <li><a href="index.html" class="hover:text-white">H∆∞·ªõng d·∫´n mua h√†ng</a></li>
                        <li><a href="index.html" class="hover:text-white">FAQ</a></li>
                    </ul>
                </div>
                
                <div>
                    <h3 class="text-lg font-semibold mb-4">Li√™n h·ªá</h3>
                    <div class="space-y-2 text-gray-400">
                        <p><i class="fas fa-map-marker-alt mr-2"></i>123 ƒê∆∞·ªùng ABC, Qu·∫≠n 1, TP.HCM</p>
                        <p><i class="fas fa-phone mr-2"></i>0123 456 789</p>
                        <p><i class="fas fa-envelope mr-2"></i>info@greenfresh.vn</p>
                    </div>
                </div>
            </div>
            
            <div class="border-t border-gray-700 mt-8 pt-8 text-center text-gray-400">
                <p>&copy; 2024 Green Fresh. T·∫•t c·∫£ quy·ªÅn ƒë∆∞·ª£c b·∫£o l∆∞u.</p>
            </div>
        </div>
    </footer>

    <script>
        // C·∫≠p nh·∫≠t s·ªë l∆∞·ª£ng gi·ªè h√†ng tr√™n icon
        function updateCartCount() {
            const cart = JSON.parse(localStorage.getItem('cart') || '[]');
            const cartCount = document.getElementById('cart-count');
            const totalItems = cart.reduce((sum, item) => sum + item.quantity, 0); 
            if (cartCount) cartCount.textContent = totalItems; 
        }
        updateCartCount();
        window.addEventListener('storage', updateCartCount);

        // H√†m hi·ªÉn th·ªã th√¥ng b√°o
        function showAlert(message, type) {
            const alertBox = document.getElementById('alert-message');
            alertBox.textContent = message;
            alertBox.classList.remove('hidden', 'bg-red-100', 'text-red-800', 'bg-green-100', 'text-green-800');
            
            if (type === 'success') {
                alertBox.classList.add('bg-green-100', 'text-green-800');
            } else {
                alertBox.classList.add('bg-red-100', 'text-red-800');
            }
            // T·ª± ƒë·ªông ·∫©n sau 5 gi√¢y
            setTimeout(() => {
                alertBox.classList.add('hidden');
            }, 5000);
        }
        
        // C·∫≠p nh·∫≠t th√¥ng tin ng∆∞·ªùi d√πng trong Header
        function updateUserInfoHeader(user) {
             const userInfo = document.getElementById('user-info');
             userInfo.innerHTML = ''; // X√≥a n·ªôi dung c≈©
             
             if (user && user.email) {
                 const displayName = user.displayName || user.email.split('@')[0];
                 const avatarUrl = user.avatarUrl || 'https://via.placeholder.com/32/10B981/FFFFFF?text=U'; // Avatar m·∫∑c ƒë·ªãnh
                
                 userInfo.innerHTML = `
                     <div class="relative group">
                         <button class="flex items-center p-2 text-green-700 hover:text-green-500 transition focus:outline-none">
                             <img src="${avatarUrl}" alt="Avatar" class="w-8 h-8 rounded-full border border-green-300 object-cover">
                             <span class="hidden md:inline text-base ml-1 font-semibold">${displayName}</span> 
                             <i class="fas fa-caret-down text-sm ml-1"></i>
                         </button>
                         
                         <div class="absolute right-0 mt-2 w-52 bg-white border border-gray-200 rounded-lg shadow-xl py-1 z-50 
                                     opacity-0 invisible group-hover:opacity-100 group-hover:visible transition-all duration-200 
                                     transform scale-95 group-hover:scale-100 origin-top-right">
                             
                             <div class="px-4 py-2 text-gray-800 border-b border-gray-100 font-bold break-words text-sm">${user.email}</div>

                             <a href="profile.html" class="block px-4 py-2 text-gray-700 hover:bg-green-100 hover:text-green-600">
                                 <i class="fas fa-address-card mr-2"></i> Th√¥ng tin c√° nh√¢n
                             </a>
                             <a href="order-history.html" class="block px-4 py-2 text-gray-700 hover:bg-green-100 hover:text-green-600">
                                 <i class="fas fa-history mr-2"></i> L·ªãch s·ª≠ ƒë∆°n h√†ng
                             </a>
                             <hr class="my-1">
                             <button id="logoutBtn" class="w-full text-left px-4 py-2 text-red-600 hover:bg-red-50 hover:text-red-700">
                                 <i class="fas fa-sign-out-alt mr-2"></i> ƒêƒÉng xu·∫•t
                             </button>
                         </div>
                     </div>
                 `;
                 
                 document.getElementById('logoutBtn').onclick = function() {
                     localStorage.removeItem('user');
                     localStorage.removeItem('token'); 
                     window.location.href = 'index.html'; 
                 };
             } else {
                 userInfo.innerHTML = `
                     <a href="login.html" class="bg-green-500 text-white px-4 py-2 rounded-full hover:bg-green-600 transition flex items-center justify-center">ƒêƒÉng nh·∫≠p</a>
                     <a href="register.html" class="bg-orange-500 text-white px-4 py-2 rounded-full hover:bg-orange-600 transition hidden sm:flex items-center justify-center">ƒêƒÉng k√Ω</a>
                 `;
             }
        }
        
        // ‚≠êÔ∏è LOGIC C·∫¨P NH·∫¨T AVATAR (Gi·∫£ l·∫≠p) ‚≠êÔ∏è
        function setupAvatarUpdate(user) {
            const avatarImg = document.getElementById('profile-avatar');
            const avatarInput = document.getElementById('avatar-input');
            const updateAvatarBtn = document.getElementById('update-avatar-btn');
            const avatarStatus = document.getElementById('avatar-status');
            
            // T·∫£i ·∫£nh ƒë·∫°i di·ªán hi·ªán t·∫°i
            avatarImg.src = user.avatarUrl || 'https://via.placeholder.com/120/10B981/FFFFFF?text=U';

            avatarInput.addEventListener('change', function(e) {
                const file = e.target.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = function(e) {
                        avatarImg.src = e.target.result;
                        updateAvatarBtn.classList.remove('hidden');
                        avatarStatus.textContent = '·∫¢nh ƒë√£ s·∫µn s√†ng. Nh·∫•n "L∆∞u Avatar".';
                        avatarStatus.classList.remove('text-red-500', 'text-green-500');
                        avatarStatus.classList.add('text-blue-500');
                    };
                    reader.readAsDataURL(file);
                }
            });

            updateAvatarBtn.addEventListener('click', function() {
                // CH·ª®C NƒÇNG GI·∫¢ L·∫¨P: L∆∞u Data URL v√†o localStorage
                // Trong th·ª±c t·∫ø, b·∫°n s·∫Ω g·ª≠i file l√™n API server ƒë·ªÉ l∆∞u tr·ªØ.
                const newAvatarUrl = avatarImg.src; 
                
                // C·∫≠p nh·∫≠t localStorage
                user.avatarUrl = newAvatarUrl;
                localStorage.setItem('user', JSON.stringify(user));
                
                updateAvatarBtn.classList.add('hidden');
                avatarStatus.textContent = 'C·∫≠p nh·∫≠t Avatar th√†nh c√¥ng! üéâ';
                avatarStatus.classList.remove('text-red-500', 'text-blue-500');
                avatarStatus.classList.add('text-green-500');
                
                // C·∫≠p nh·∫≠t l·∫°i header ngay l·∫≠p t·ª©c
                updateUserInfoHeader(user);
            });
        }


        // ‚≠êÔ∏è LOGIC ƒê·ªîI M·∫¨T KH·∫®U ‚≠êÔ∏è
        function setupPasswordUpdate(token) {
             document.getElementById('password-form').addEventListener('submit', function(e) {
                e.preventDefault();
                const status = document.getElementById('password-status');
                status.textContent = 'ƒêang ƒë·ªïi m·∫≠t kh·∫©u...';
                status.classList.remove('text-red-500', 'text-green-500');
                status.classList.add('text-gray-500');

                const currentPass = document.getElementById('current-password').value;
                const newPass = document.getElementById('new-password').value;

                if (newPass.length < 6) {
                    status.textContent = 'M·∫≠t kh·∫©u m·ªõi ph·∫£i c√≥ √≠t nh·∫•t 6 k√Ω t·ª±.';
                    status.classList.remove('text-gray-500');
                    status.classList.add('text-red-500');
                    return;
                }
                
                fetch('https://exe-zjbe.onrender.com/api/user/change-password', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${token}`
                    },
                    body: JSON.stringify({ currentPassword: currentPass, newPassword: newPass })
                })
                .then(res => res.json())
                .then(data => {
                    if (data.status === 'success') {
                        status.textContent = 'ƒê·ªïi m·∫≠t kh·∫©u th√†nh c√¥ng! Vui l√≤ng ƒëƒÉng nh·∫≠p l·∫°i.';
                        status.classList.remove('text-gray-500', 'text-red-500');
                        status.classList.add('text-green-500');
                        
                        // X√≥a token v√† bu·ªôc ƒëƒÉng xu·∫•t sau 3 gi√¢y
                        setTimeout(() => {
                            localStorage.removeItem('user');
                            localStorage.removeItem('token');
                            window.location.href = 'login.html';
                        }, 3000);

                    } else {
                        status.textContent = data.message || 'ƒê·ªïi m·∫≠t kh·∫©u th·∫•t b·∫°i. Ki·ªÉm tra m·∫≠t kh·∫©u hi·ªán t·∫°i.';
                        status.classList.remove('text-gray-500', 'text-green-500');
                        status.classList.add('text-red-500');
                    }
                })
                .catch(error => {
                    console.error('Error changing password:', error);
                    status.textContent = 'L·ªói k·∫øt n·ªëi ho·∫∑c h·ªá th·ªëng. Vui l√≤ng th·ª≠ l·∫°i.';
                    status.classList.remove('text-gray-500', 'text-green-500');
                    status.classList.add('text-red-500');
                });
            });
        }

        // Logic ch√≠nh ƒë·ªÉ t·∫£i trang Profile v√† x·ª≠ l√Ω ƒëƒÉng nh·∫≠p
        document.addEventListener('DOMContentLoaded', function() {
            const userLocalStorage = localStorage.getItem('user');
            const token = localStorage.getItem('token');
            let user = null;

            // X·ª≠ l√Ω l·ªói JSON khi ƒë·ªçc localStorage
            if (userLocalStorage) {
                try {
                    user = JSON.parse(userLocalStorage);
                } catch (e) {
                    localStorage.removeItem('user');
                    user = null;
                }
            }

            // Ki·ªÉm tra ƒëƒÉng nh·∫≠p
            if (user && user.email && token) { 
                
                // --- 1. T·∫¢I D·ªÆ LI·ªÜU V√ÄO FORM ---
                document.getElementById('email').value = user.email || '';
                document.getElementById('displayName').value = user.displayName || '';
                document.getElementById('phone').value = user.phone || '';
                document.getElementById('address').value = user.address || '';
                if (user.gender) {
                    document.getElementById('gender').value = user.gender;
                }

                // --- 2. X·ª¨ L√ù HEADER ---
                updateUserInfoHeader(user);
                
                // --- 3. SETUP CH·ª®C NƒÇNG AVATAR & M·∫¨T KH·∫®U ---
                setupAvatarUpdate(user);
                setupPasswordUpdate(token);

                // --- 4. X·ª¨ L√ù SUBMIT PROFILE FORM ---
                document.getElementById('profile-form').onsubmit = function(e) {
                    e.preventDefault();
                    
                    const newDisplayName = document.getElementById('displayName').value;
                    const newPhone = document.getElementById('phone').value;
                    const newAddress = document.getElementById('address').value;
                    const newGender = document.getElementById('gender').value;

                    // G·ª≠i th√¥ng tin l√™n Backend
                    fetch('https://exe-zjbe.onrender.com/api/users/update-profile', { 
                        method: 'PUT',
                        headers: { 
                            'Content-Type': 'application/json',
                            'Authorization': `Bearer ${token}` 
                        },
                        body: JSON.stringify({
                            email: user.email, // G·ª≠i email ƒë·ªÉ x√°c ƒë·ªãnh ng∆∞·ªùi d√πng
                            displayName: newDisplayName,
                            phone: newPhone,
                            address: newAddress,
                            gender: newGender
                        })
                    })
                    .then(response => {
                        if (!response.ok) {
                            if (response.status === 401) {
                                localStorage.removeItem('user');
                                localStorage.removeItem('token');
                                alert('Phi√™n ƒëƒÉng nh·∫≠p ƒë√£ h·∫øt h·∫°n. Vui l√≤ng ƒëƒÉng nh·∫≠p l·∫°i.');
                                window.location.href = 'login.html';
                            }
                            return response.json().then(err => { throw new Error(err.message || 'L·ªói c·∫≠p nh·∫≠t h·ªì s∆°'); });
                        }
                        return response.json();
                    })
                    .then(data => {
                        // C·∫≠p nh·∫≠t l·∫°i localStorage sau khi c·∫≠p nh·∫≠t th√†nh c√¥ng
                        const updatedUser = { 
                            ...user, 
                            displayName: newDisplayName, 
                            phone: newPhone, 
                            address: newAddress, 
                            gender: newGender 
                        };
                        localStorage.setItem('user', JSON.stringify(updatedUser));
                        
                        showAlert('C·∫≠p nh·∫≠t h·ªì s∆° th√†nh c√¥ng! (T√™n, SƒêT, ƒê·ªãa ch·ªâ)', 'success');
                        
                        // C·∫≠p nh·∫≠t l·∫°i t√™n hi·ªÉn th·ªã tr√™n header
                        updateUserInfoHeader(updatedUser);
                    })
                    .catch(error => {
                        console.error('L·ªói khi c·∫≠p nh·∫≠t h·ªì s∆°:', error);
                        showAlert(error.message || 'ƒê√£ x·∫£y ra l·ªói trong qu√° tr√¨nh c·∫≠p nh·∫≠t.', 'error');
                    });
                };

            } else {
                // X·ª≠ l√Ω tr∆∞·ªùng h·ª£p ch∆∞a ƒëƒÉng nh·∫≠p
                alert('B·∫°n c·∫ßn ƒëƒÉng nh·∫≠p ƒë·ªÉ xem trang th√¥ng tin c√° nh√¢n.');
                window.location.href = 'login.html'; 
            }
        });
    </script>
</body>
</html>